---
path: 'docs/git-workflows.mdx'
title: 'Git Workflow & Automated Releases'
description: 'Complete guide to branching strategy, commit conventions, automated testing, and semantic releases with GitHub Actions.'
order: 3
icon: 'mdi:git'
author: 'admin'
created: '2025-09-28'
updated: '2025-10-25'
tags:
  - 'git'
  - 'workflow'
  - 'release'
  - 'contribution'
  - 'development'
  - 'ci-cd'
  - 'testing'
---

# Git Workflow & Automated Releases

## Introduction

SveltyCMS uses a comprehensive Git workflow with **automated testing** and **semantic versioning** to ensure code quality and streamline the release process. Understanding this workflow is essential for all contributors.

Our CI/CD pipeline uses:

- **Playwright + Bun Tests** for comprehensive testing
- **Semantic Release** for automated versioning
- **GitHub Actions** for CI/CD automation
- **Test Gating** to ensure releases only happen when tests pass

- **Test Gating** to ensure releases only happen when tests pass

---

## Table of Contents

1. [Branching Strategy](#branching-strategy)
2. [Commit Message Convention](#commit-message-convention)
3. [GitHub Actions Workflows](#github-actions-workflows)
4. [Automated Testing](#automated-testing)
5. [Release Process](#release-process)
6. [Development Workflow](#development-workflow)
7. [Best Practices](#best-practices)

---

## Branching Strategy

We have two primary, long-lived branches: **main** and **next**.

### `main` Branch (Production)

**Purpose:** Production-ready, stable code. This branch represents the latest official release.

**Protection:**

- Protected branch requiring pull request reviews
- All code must first be merged into `next`
- Promoted to `main` only after thorough testing
- **Tests must pass** before any release is created

**Automated Actions:**

- ‚úÖ Runs full Playwright + Bun test suite
- ‚úÖ Only releases if tests pass
- ‚úÖ Creates stable semantic version (e.g., `v1.3.0`)
- ‚úÖ Automatically cleans `/config/collections` directory
- ‚úÖ Generates changelog and release notes

**Key Rule:** This branch must never contain test configurations. The `/config/collections` directory is automatically removed during the release process.

### `next` Branch (Development)

**Purpose:** Development and staging. This is the primary branch for all new features, bug fixes, and ongoing work.

**Pull Requests:** All contributions should be made to feature branches and then submitted as pull requests targeting `next`.

**Automated Actions:**

- ‚úÖ Runs full test suite on every push
- ‚úÖ Tests both dev and preview modes
- ‚úÖ Matrix testing across multiple browsers
- ‚úÖ No automatic releases (tests only)

**Testing Strategy:**

- Every push triggers comprehensive E2E and unit tests
- Tests run in both development and production build modes
- MongoDB service container for database testing
- - Automated database seeding before tests

---

## Commit Message Convention

Our automated release process depends on a strict commit message format. We use the **Conventional Commits** specification. The release automation analyzes these messages to determine if a new version should be released and what the version number should be.

### Format

Each commit message consists of a **type**, a **scope** (optional), and a **subject**:

```
<type>(<scope>): <subject>

[optional body]

[optional footer]
```

### Common Commit Types

| Type              | Description              | Version Impact        | Example                           |
| ----------------- | ------------------------ | --------------------- | --------------------------------- |
| `feat`            | A new feature            | MINOR (1.2.0 ‚Üí 1.3.0) | `feat(auth): add OAuth2 login`    |
| `fix`             | A bug fix                | PATCH (1.2.0 ‚Üí 1.2.1) | `fix(api): resolve memory leak`   |
| `docs`            | Documentation only       | None                  | `docs: update installation guide` |
| `style`           | Code style changes       | None                  | `style: fix indentation`          |
| `refactor`        | Code refactoring         | None                  | `refactor: simplify auth logic`   |
| `perf`            | Performance improvements | PATCH                 | `perf(db): optimize query speed`  |
| `test`            | Adding or updating tests | None                  | `test: add collection tests`      |
| `chore`           | Build/tooling changes    | None                  | `chore: update dependencies`      |
| `ci`              | CI/CD configuration      | None                  | `ci: update GitHub Actions`       |
| `BREAKING CHANGE` | Breaking API change      | MAJOR (1.2.0 ‚Üí 2.0.0) | See below                         |

### Breaking Changes

To trigger a **MAJOR** version release, use one of these methods:

**Method 1: Add `!` after type**

```
feat!: redesign collection API
```

**Method 2: Add `BREAKING CHANGE:` footer**

```
feat(api): redesign collection endpoints

BREAKING CHANGE: The collection API now uses different parameter names
```

**‚ö†Ô∏è IMPORTANT:** If your commit doesn't use `feat`, `fix`, or `BREAKING CHANGE`, the automated system will **not** create a new version.

---

## GitHub Actions Workflows

SveltyCMS uses two main workflows for CI/CD automation.

### Workflow 1: Playwright Tests

**File:** `.github/workflows/playwright.yml`

**Triggers:**

- Push to `main` or `next`
- Pull requests to `main`
- Called by auto-release workflow

**What it does:**

1. Sets up environment (Bun, Node, Playwright)
2. Starts MongoDB service container
3. **Seeds database** (`scripts/seed-cms.js`)
4. **Creates admin user** (`scripts/create-admin.js`)
5. Runs tests in dev and preview modes
6. Uploads test results and artifacts

### Workflow 2: Auto-Release

**File:** `.github/workflows/auto-release.yaml`

**Triggers:**

- Push to `main` branch only

**What it does:**

1. **Runs tests first** (calls playwright.yml)
2. **Only releases if tests pass**
3. Cleans `/config/collections` directory
4. Runs semantic-release (version bump, changelog, GitHub release)

---

## Release Process

### Complete Flow

**Development (‚Üí `next`):**

```
1. Create feature branch
2. Make changes with conventional commits
3. Push and create PR to 'next'
4. Tests run automatically
5. Merge after approval
6. Tests run on 'next' (no release)
```

**Release (‚Üí `main`):**

```
1. Create PR from 'next' to 'main'
2. Tests run automatically
3. Merge after approval
4. Tests run on 'main'
5. If tests pass ‚Üí semantic-release creates version
6. If tests fail ‚Üí no release
```

---

## Best Practices

**Commit Messages:**
‚úÖ `feat(auth): add OAuth2 support`
‚úÖ `fix(api): resolve memory leak`
‚úÖ `docs: update CI/CD guide`

‚ùå `fixed stuff`
‚ùå `WIP`
‚ùå `changes`

**Pull Requests:**

- Always target `next` branch
- Keep PRs focused and small
- Ensure tests pass locally first
- Respond to reviews promptly

**Testing:**

```bash
# Run locally before pushing
bun test
npx playwright test
```

---

## Related Documentation

- [Complete Workflow Guide](/docs/architecture/initialization-workflow.mdx) - Installation, setup, testing
- [Contributing Guide](/CONTRIBUTING.md) - How to contribute
- [Troubleshooting](/docs/troubleshooting.mdx) - Common issues

---

**Follow these workflows for smooth development and reliable releases! üöÄ**

---

Our automated release process depends on a strict commit message format. We use the Conventional Commits specification. The release automation analyzes these messages to determine if a new version should be released and what the version number should be.

Each commit message consists of a type, a scope (optional), and a subject.

`<type>(<scope>): <subject>`

Common Commit Types
feat: A new feature. (Results in a MINOR release, e.g., 1.2.0 -> 1.3.0)

fix: A bug fix. (Results in a PATCH release, e.g., 1.2.0 -> 1.2.1)

docs: Documentation only changes.

style: Changes that do not affect the meaning of the code (white-space, formatting, etc).

refactor: A code change that neither fixes a bug nor adds a feature.

perf: A code change that improves performance.

test: Adding missing tests or correcting existing tests.

chore: Changes to the build process or auxiliary tools and libraries.

BREAKING CHANGE: A commit that has a footer BREAKING CHANGE: or appends a ! after the type/scope, introduces a breaking API change and will result in a MAJOR version release (e.g., 1.2.0 -> 2.0.0).

IMPORTANT: If your commit does not use one of these types (especially feat, fix, or a BREAKING CHANGE), the automated system will not create a new version.

The Automated Release Process
The automation is triggered on every push to the main and next branches.

Workflow on the next Branch (Pre-releases)
Development: Work is done on feature branches.

Pull Request: A PR is opened from the feature branch to next.

Merge: Once the PR is approved and merged into next, the GitHub Action is triggered.

Automation: semantic-release analyzes the new commits. If a feat, fix, or BREAKING CHANGE is found, it creates a pre-release on GitHub with a tag like v1.2.3-next.1 and generates release notes.

Workflow on the main Branch (Stable Releases)
Promotion: When next is stable and ready for a full release, a pull request is opened from next to main.

Merge: Once the pull request is approved and merged, the GitHub Action is triggered again.

Automation Steps:

The workflow checks out the main branch.

It deletes the /config/collections directory to create a clean, production-ready state.

semantic-release analyzes the commits being merged from next.

It then bumps the package.json version, updates the CHANGELOG.md, and publishes a new stable release on GitHub (e.g., v1.3.0).
