---
path: 'docs/dev-guide/widget-documentation-summary.mdx'
title: 'Widget Documentation Summary'
description: 'Quick reference guide to SveltyCMS widget system documentation, architecture, and core system files.'
order: 10
icon: 'mdi:file-document-multiple'
author: 'admin'
created: '2025-01-15'
updated: '2025-01-15'
tags:
  - 'widgets'
  - 'documentation'
  - 'reference'
  - 'summary'
---

# Widget Documentation Summary

## Quick Reference

This page provides a quick reference to the SveltyCMS widget system documentation.

---

## Documentation Structure

### 1. [Widget System Architecture](/docs/dev-guide/widget-system-architecture.mdx)

**Focus**: How widgets are created and structured

**Covers**:

- Factory pattern with `createWidget()`
- Three Pillars architecture (Definition, Input, Display)
- Core widget system files explained:
  - `src/widgets/factory.ts` - Widget factory
  - `src/widgets/index.ts` - Widget loader
  - `src/widgets/registry.ts` - Widget registry
  - `src/widgets/types.ts` - Widget types
  - `src/widgets/MissingWidget.svelte` - Fallback component
  - `src/widgets/widgetManager.svelte.ts` - Legacy compatibility
- MDX documentation per widget
- Valibot validation
- Creating new widgets
- Widget dependencies

**Read this when**: Creating new widgets, understanding widget architecture

---

### 2. [Widget Store Management](/docs/dev-guide/widget-management-system.mdx)

**Focus**: Managing widget activation and configuration

**Covers**:

- Widget store (`src/stores/widgetStore.svelte.ts`)
- Store actions (initialize, activate, deactivate)
- Widget state management
- Multi-tenant support
- API endpoints for widget operations
- Collection validation
- Dependency resolution
- Error handling

**Read this when**: Managing widget activation, configuring tenants, using widget APIs

---

## Core System Files Explained

### Widget Creation Files

#### `src/widgets/factory.ts`

**Purpose**: Type-safe widget factory for creating widget definitions

**What it does**:

- Exports `createWidget<TProps>()` function
- Ensures type safety with TypeScript generics
- Implements Three Pillars architecture
- Combines defaults with field configuration
- Provides `WidgetConfig` and `FieldConfig` types

**Usage**:

```typescript
import { createWidget } from '@src/widgets/factory';
import { string } from 'valibot';

const MyWidget = createWidget<MyProps>({
	Name: 'MyWidget',
	inputComponentPath: '/src/widgets/core/mywidget/Input.svelte',
	displayComponentPath: '/src/widgets/core/mywidget/Display.svelte',
	validationSchema: string(),
	defaults: { color: 'primary' }
});
```

---

#### `src/widgets/index.ts`

**Purpose**: Main entry point for widget system initialization

**What it does**:

- Dynamically imports all widgets from `core/` and `custom/` directories
- Creates widget functions with unique IDs
- Checks widget dependencies
- Registers widgets in central registry
- Manages reactive stores for widget state
- Exports widgets globally

**Key Functions**:

- `initializeWidgets()` - Load all widgets
- `ensureWidgetsInitialized()` - Idempotent initialization
- `checkDependencies()` - Validate widget dependencies

**Auto-discovery**: Automatically finds and loads all widgets in `src/widgets/core/` and `src/widgets/custom/`

---

#### `src/widgets/registry.ts`

**Purpose**: Centralized widget registry to prevent circular dependencies

**What it does**:

- Maintains global `Map<string, Widget>` of registered widgets
- Provides safe access to widget instances
- Prevents circular dependency issues
- Supports runtime widget lookup

**API**:

```typescript
registerWidget(widget: Widget): void
getWidget(name: string): Widget | undefined
getAllWidgets(): Record<string, Widget>
getWidgetNames(): string[]
hasWidget(name: string): boolean
clearRegistry(): void  // Testing
```

---

#### `src/widgets/types.ts`

**Purpose**: TypeScript type definitions for widget system

**What it does**:

- Defines `Widget` interface (registered widget instance)
- Defines `WidgetFunction` interface (widget constructor)
- Defines `WidgetModule` interface (imported module)
- Defines `WidgetStatus` type (`'active' | 'inactive'`)
- Provides type safety across widget system

**Key Types**:

```typescript
export interface Widget {
	__widgetId: string;
	Name: string;
	dependencies?: string[];
	validateWidget: () => Promise<string | null>;
	updateTranslationStatus: (...) => void;
	// ... more properties
}

export interface WidgetFunction {
	(config: Record<string, unknown>): Field;
	Name?: string;
	Icon?: string;
	dependencies?: string[];
	__widgetId?: string;
	__isCore?: boolean;
	// ... more properties
}
```

---

#### `src/widgets/MissingWidget.svelte`

**Purpose**: Fallback component for missing or disabled widgets

**What it does**:

- Renders warning when widget cannot be found
- Shows widget name that was requested
- Prevents application crashes
- Provides visual feedback to developers

**Displays**: `⚠️ Widget "WidgetName" is missing or disabled.`

---

#### `src/widgets/widgetManager.svelte.ts`

**Purpose**: Legacy compatibility layer for old widget API

**What it does**:

- Provides backward compatibility with old code
- Bridges new store-based system with legacy code
- Exports legacy functions for gradual migration

**Migration Path**: Replace imports from `widgetManager` with new `widgetStore` API

---

### State Management Files

#### `src/stores/widgetStore.svelte.ts`

**Purpose**: Centralized state management for widget activation and configuration

**What it provides**:

- Reactive stores for widget state
- Widget store actions for operations
- Multi-tenant support
- Dependency management
- Collection validation

**Key Exports**:

```typescript
// Derived stores
export const widgets: Readable<Record<string, Widget>>
export const widgetFunctions: Readable<Map<string, WidgetFunction>>
export const activeWidgets: Readable<string[]>
export const coreWidgets: Readable<string[]>
export const customWidgets: Readable<string[]>

// Helper functions
export function getWidget(name: string): Widget | undefined
export function isWidgetActive(name: string): boolean
export function canDisableWidget(name: string): boolean

// Store actions
export const widgetStoreActions = {
	initializeWidgets(tenantId?): Promise<void>
	updateWidgetStatus(name, status, tenantId?): Promise<void>
	bulkActivateWidgets(names[], tenantId?): Promise<void>
	// ... more methods
}
```

---

## Widget Structure

Each widget follows this consistent structure:

```
src/widgets/core/checkbox/
├── index.ts           # Widget definition (factory)
├── types.ts           # Widget-specific TypeScript types
├── Input.svelte       # Input component (editing UI)
├── Display.svelte     # Display component (viewing UI)
└── checkbox.mdx       # Widget documentation (mdsvex)
```

### File Purposes

| File             | Purpose               | Contains                                       |
| ---------------- | --------------------- | ---------------------------------------------- |
| `index.ts`       | Widget definition     | Factory call with config, validation, defaults |
| `types.ts`       | Type definitions      | Widget-specific prop types                     |
| `Input.svelte`   | Interactive component | Form input for editing field values            |
| `Display.svelte` | View component        | Read-only display for lists/views              |
| `{name}.mdx`     | Documentation         | Usage, examples, configuration, accessibility  |

---

## MDX Documentation

### Why MDX?

Each widget has its own `.mdx` file because:

1. **Standard MDX Format**: Following industry-standard MDX conventions for documentation
2. **mdsvex Integration**: We use [mdsvex](https://mdsvex.pngwn.io/) for Svelte-compatible MDX support
3. **Interactive**: Can embed Svelte components in docs
4. **Type-Safe**: Documentation lives next to code
5. **Maintainable**: Docs update with widget changes
6. **Discoverable**: Easy to find widget documentation

### MDX Structure

````mdx
---
path: 'src/widgets/core/checkbox/checkbox.mdx'
title: 'Checkbox Field'
description: 'Boolean toggle field for true/false values'
order: 6
icon: 'tabler:checkbox'
author: 'admin'
created: '2025-09-29'
updated: '2025-09-29'
tags:
  - 'widget'
  - 'checkbox'
  - 'core'
---

# Checkbox Field

Overview of the widget...

## Features

- Feature 1
- Feature 2

## Usage

\```typescript
widgets.Checkbox({ label: 'Featured' })
\```

## Configuration

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |

| ...

## Validation

Valibot validation details...

## Accessibility

A11y considerations...
````

### Required Sections

Every widget `.mdx` should include:

1. **Frontmatter**: Metadata (path, title, description, order, icon, author, dates, tags)
2. **Overview**: What the widget does
3. **Features**: Key capabilities
4. **Usage**: Code examples
5. **Configuration**: Property table
6. **Validation**: Valibot schema
7. **Accessibility**: A11y notes

---

## Three Pillars Architecture

The widget system uses the **Three Pillars** pattern:

### 1. Definition (`index.ts`)

The widget's blueprint created with `createWidget()`:

```typescript
const CheckboxWidget = createWidget<CheckboxProps>({
	Name: 'Checkbox',
	Icon: 'tabler:checkbox',
	inputComponentPath: '/src/widgets/core/checkbox/Input.svelte',
	displayComponentPath: '/src/widgets/core/checkbox/Display.svelte',
	validationSchema: boolean(),
	defaults: { color: 'primary' }
});
```

### 2. Input (`Input.svelte`)

Interactive component for editing field values:

```svelte
<script lang="ts">
	let { field, value = $bindable() } = $props();
</script>

<input type="checkbox" bind:checked={value} />
```

### 3. Display (`Display.svelte`)

Lightweight component for viewing field values:

```svelte
<script lang="ts">
	let { field, value } = $props();
</script>

<span>{value ? '✓' : '✗'}</span>
```

---

## Quick Start Guide

### Creating a New Widget

1. **Create Directory**:

   ```
   src/widgets/core/mywidget/
   ```

2. **Create Types** (`types.ts`):

   ```typescript
   export interface MyWidgetProps {
   	color?: 'primary' | 'secondary';
   	size?: 'sm' | 'md' | 'lg';
   }
   ```

3. **Create Definition** (`index.ts`):

   ```typescript
   import { createWidget } from '@src/widgets/factory';
   import { string } from 'valibot';

   const MyWidget = createWidget<MyWidgetProps>({
   	Name: 'MyWidget',
   	inputComponentPath: '/src/widgets/core/mywidget/Input.svelte',
   	displayComponentPath: '/src/widgets/core/mywidget/Display.svelte',
   	validationSchema: string(),
   	defaults: { color: 'primary', size: 'md' }
   });

   export default MyWidget;
   ```

4. **Create Input** (`Input.svelte`):

   ```svelte
   <script lang="ts">
   	let { field, value = $bindable() } = $props();
   </script>

   <input bind:value type="text" />
   ```

5. **Create Display** (`Display.svelte`):

   ```svelte
   <script lang="ts">
   	let { field, value } = $props();
   </script>

   <span>{value || '—'}</span>
   ```

6. **Create Documentation** (`mywidget.mdx`):

   ```mdx
   ---
   path: 'src/widgets/core/mywidget/mywidget.mdx'
   title: 'My Widget'
   description: 'Custom widget description'
   order: 20
   icon: 'mdi:widgets'
   ---

   # My Widget

   Documentation here...
   ```

7. **Auto-Discovery**: Widget automatically loads on next restart

---

## Managing Widgets

### Activate/Deactivate

```typescript
import { widgetStoreActions } from '@stores/widgetStore.svelte';

// Activate widget
await widgetStoreActions.updateWidgetStatus('SEO', 'active');

// Deactivate widget (if no dependencies)
await widgetStoreActions.updateWidgetStatus('Gallery', 'inactive');
```

### Bulk Activation

```typescript
// Activates widgets + dependencies automatically
await widgetStoreActions.bulkActivateWidgets(['SEO', 'Gallery', 'Comments']);
```

### Check Status

```typescript
import { isWidgetActive, canDisableWidget } from '@stores/widgetStore.svelte';

if (isWidgetActive('SEO')) {
	console.log('SEO is active');
}

if (canDisableWidget('Gallery')) {
	// Safe to disable
}
```

---

## Validation with Valibot

All widgets use [Valibot](https://valibot.dev/) for validation:

```typescript
import { pipe, string, minLength, maxLength, email } from 'valibot';

// Simple
const simple = string();

// With constraints
const constrained = pipe(string(), minLength(1, 'Required'), maxLength(255, 'Too long'));

// Email
const emailSchema = pipe(string(), email('Invalid email'));
```

---

## API Endpoints

### GET `/api/widgets/active`

Get active widgets for tenant

### POST `/api/widgets/status`

Update widget activation status

### GET `/api/widgets/required`

Get widgets required by collections

### GET `/api/widgets/validate`

Validate collections against widget state

See [Widget Store Management](/docs/dev-guide/widget-management-system.mdx) for details.

---

## Common Questions

### Q: Where do I create a new widget?

**A**: `src/widgets/core/{widgetname}/` (core) or `src/widgets/custom/{widgetname}/` (custom)

### Q: Do I need to register widgets manually?

**A**: No, widgets are auto-discovered from `src/widgets/core/` and `src/widgets/custom/`

### Q: How do I document a widget?

**A**: Create `{widgetname}.mdx` in the widget directory using [mdsvex](https://mdsvex.pngwn.io/) format

### Q: What's the difference between core and custom widgets?

**A**: Core widgets are always active, custom widgets can be enabled/disabled per tenant

### Q: How do I handle dependencies?

**A**: Declare in widget definition: `MyWidget.dependencies = ['Input', 'RichText']`

### Q: Can I disable a core widget?

**A**: No, core widgets cannot be disabled (they're essential)

### Q: How do I activate multiple widgets at once?

**A**: Use `widgetStoreActions.bulkActivateWidgets(['Widget1', 'Widget2'])`

### Q: What is the Three Pillars pattern?

**A**: Separation of Definition (index.ts), Input (Input.svelte), Display (Display.svelte)

### Q: Why use Valibot instead of Zod?

**A**: Valibot is smaller, faster, and more type-safe for widget validation

### Q: How do I test a widget?

**A**: Create unit tests for the widget function and integration tests for components

---

## Resources

### Documentation

- [Widget System Architecture](/docs/dev-guide/widget-system-architecture.mdx) - Creating widgets
- [Widget Store Management](/docs/dev-guide/widget-management-system.mdx) - Managing widgets
- [Collection Builder](/docs/user-guide/collection-builder.mdx) - Using widgets

### External

- [Valibot Documentation](https://valibot.dev/) - Validation library
- [mdsvex Documentation](https://mdsvex.pngwn.io/) - MDX for Svelte
- [SvelteKit Documentation](https://kit.svelte.dev/) - Framework

---

## Summary

**Widget System Files**:

- `factory.ts` - Create widgets with `createWidget()`
- `index.ts` - Auto-discover and load widgets
- `registry.ts` - Central widget registry
- `types.ts` - TypeScript type definitions
- `MissingWidget.svelte` - Fallback component
- `widgetManager.svelte.ts` - Legacy compatibility

**Widget Structure**:

- `index.ts` - Definition (factory)
- `types.ts` - Type definitions
- `Input.svelte` - Interactive component
- `Display.svelte` - View component
- `{name}.mdx` - Documentation (mdsvex)

**State Management**:

- `widgetStore.svelte.ts` - Reactive stores + actions

**Documentation**:

- [Widget System Architecture](/docs/dev-guide/widget-system-architecture.mdx) - Architecture & creation
- [Widget Store Management](/docs/dev-guide/widget-management-system.mdx) - Management & APIs

For questions, see [FAQ](/docs/user-guide/faq.mdx) or [Contributing Guide](/docs/contributing/contributing-docs.mdx).
